(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function e(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",r)}function n(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)}function r(t){"Escape"===t.key&&n(document.querySelector(".popup_is-opened"))}function o(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}t.d({},{T:()=>y,o:()=>$});var c={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-37",headers:{authorization:"446cb656-53f7-4156-b587-52a91e97c857","Content-Type":"application/json"}};function a(t,e){return fetch(t,e).then(o)}function i(t,e,n,r){var o=y.querySelector(".card").cloneNode(!0),c=o.querySelector(".card__delete-button"),a=o.querySelector(".card__like-button"),i=o.querySelector(".card__title"),l=o.querySelector(".card__image"),s=o.querySelector(".card__like-counter");return i.textContent=t.name,l.src=t.link,l.alt="Фотография места: ".concat(t.name),t.likes.some((function(t){return t._id==r._id}))&&a.classList.add("card__like-button_is-active"),u(t,s),r&&t.owner._id!==r._id&&c.remove(),c.addEventListener("click",(function(){$(t)})),a.addEventListener("click",(function(n){e(n,t,s)})),l.addEventListener("click",n),o.setAttribute("data-card-id","".concat(t._id)),o}function u(t,e){e.textContent=t.likes.length}function l(t,e,n){var r;t.target.classList.contains("card__like-button_is-active")?function(t){return a("".concat(c.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:c.headers})}(e._id).then((function(e){t.target.classList.remove("card__like-button_is-active"),u(e,n)})).catch((function(t){console.log(t)})):(r=e._id,a("".concat(c.baseUrl,"/cards/likes/").concat(r),{method:"PUT",headers:c.headers})).then((function(e){t.target.classList.add("card__like-button_is-active"),u(e,n)})).catch((function(t){console.log(t)}))}function s(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function d(t,e){t.disabled=!0,t.classList.add(e.inactiveButtonClass)}function f(t,e){var n=t.querySelector(e.submitButtonSelector),r=Array.from(t.querySelectorAll(e.inputSelector));d(n,e),r.forEach((function(n){s(t,n,e)}))}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var m,_,y=document.querySelector("#card-template").content,v=document.querySelectorAll(".popup"),h=document.querySelectorAll(".popup__close"),b=document.querySelector(".content"),S=b.querySelector(".places__list"),g=b.querySelector(".profile__title"),E=b.querySelector(".profile__description"),q=b.querySelector(".profile__image"),L=b.querySelector(".profile__edit-button"),k=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_edit-avatar"),A=document.forms.avatar,x=A.elements.link,T=document.forms.profile,U=T.elements.name,O=T.elements.description,j=b.querySelector(".profile__add-button"),w=document.querySelector(".popup_type_new-card"),I=document.forms.places,P=I.elements.name,B=I.elements.link,D=document.querySelector(".popup_type_image"),M=D.querySelector(".popup__image"),N=D.querySelector(".popup__caption"),J=document.querySelector(".popup_type_submit_delete"),G=J.querySelector(".popup__button"),H={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input_error-active"};function V(t){t.submitter.textContent="Сохранение..."}function z(t){t.submitter.textContent="Сохранить"}function $(t){G.setAttribute("data-card-id","".concat(t._id)),e(J)}function F(t){M.src=t.target.src,M.alt=t.target.alt,N.textContent=t.target.alt.slice(18),e(D)}function K(t){Array.from(t.elements).forEach((function(t){t.value=""}))}Promise.all([a("".concat(c.baseUrl,"/users/me"),{method:"GET",headers:c.headers}),a("".concat(c.baseUrl,"/cards"),{method:"GET",headers:c.headers})]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return p(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return{profileInfo:r[0],inittialCards:r[1]}})).then((function(t){!function(t){g.textContent=t.profileInfo.name,E.textContent=t.profileInfo.about,q.setAttribute("style","background-image: url(".concat(t.profileInfo.avatar,")"))}(t),t.inittialCards.forEach((function(e){S.append(i(e,l,F,t.profileInfo))}))})).catch((function(t){console.log(t)})),h.forEach((function(t){t.addEventListener("click",(function(){n(t.closest(".popup"))}))})),document.addEventListener("click",(function(t){t.target.classList.contains("popup_is-opened")&&!t.target.classList.contains("popup__content")&&n(t.target.closest(".popup"))})),L.addEventListener("click",(function(){var t,n;e(k),t=g,n=E,U.value=t.textContent,O.value=n.textContent,f(T,H)})),q.addEventListener("click",(function(){e(C),f(A,H)})),j.addEventListener("click",(function(){e(w),f(I,H)})),T.addEventListener("submit",(function(t){var e,r;t.preventDefault(),V(t),(e=U.value,r=O.value,a("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:r})})).then((function(t){g.textContent=t.name,E.textContent=t.about,n(k)})).catch((function(t){console.log(t)})).finally((function(){z(t)}))})),I.addEventListener("submit",(function(t){t.preventDefault(),V(t);var e,r,o={name:P.value,link:B.value};(e=o.name,r=o.link,a("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:r})})).then((function(t){S.prepend(i(t,l,F)),n(w),K(I),f(I,H)})).catch((function(t){console.log(t)})).finally((function(){z(t)}))})),A.addEventListener("submit",(function(t){var e;t.preventDefault(),V(t),(e=x.value,a("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})})).then((function(t){q.setAttribute("style",'background-image: url("'.concat(t.avatar,'")')),n(C),K(A)})).catch((function(t){console.log(t)})).finally((function(){z(t)}))})),G.addEventListener("click",(function(){var t,e;S.querySelectorAll(".card").forEach((function(t){t.getAttribute("data-card-id")===G.getAttribute("data-card-id")&&(m=t)})),(t=m,e=m.getAttribute("data-card-id"),function(t){return a("".concat(c.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:c.headers})}(e).then((function(){t.remove()}))).then((function(){n(J)})).catch((function(t){console.log(t)}))})),v.forEach((function(t){t.classList.add("popup_is-animated")})),_=H,Array.from(document.querySelectorAll(_.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?s(t,e,n):function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.classList.add(r.errorClass),o.textContent=n}(t,e,e.validationMessage,n)}(t,o,e),function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?function(t,e){t.disabled=!1,t.classList.remove(e.inactiveButtonClass)}(e,n):d(e,n)}(n,r,e)}))}))}(t,_)}))})();